{{define "title"}}Request Logs{{end}}
{{define "content"}}
<div>
    <h1 class="text-[15px] font-medium text-white mb-5">Request Logs</h1>

    {{if .Data.Stats}}
    <div class="grid grid-cols-2 lg:grid-cols-3 gap-3 mb-6">
        <div class="border border-line rounded-lg px-4 py-3">
            <div class="text-[10px] text-muted uppercase tracking-widest mb-1">Requests</div>
            <div class="text-2xl font-semibold text-white tabular-nums">{{.Data.Stats.TotalRequests}}</div>
        </div>
        <div class="border border-line rounded-lg px-4 py-3">
            <div class="text-[10px] text-muted uppercase tracking-widest mb-1">Visitors</div>
            <div class="text-2xl font-semibold text-muted-light tabular-nums">{{.Data.Stats.UniqueVisitors}}</div>
        </div>
        <div class="border border-line rounded-lg px-4 py-3">
            <div class="text-[10px] text-muted uppercase tracking-widest mb-1">Avg Latency</div>
            <div class="text-2xl font-semibold text-muted-light tabular-nums">{{formatMs .Data.Stats.AvgLatencyMs}}</div>
        </div>
    </div>
    {{end}}

    <div class="flex flex-wrap items-center gap-3 mb-3">
        <div class="flex gap-1.5">
            <a href="{{.BasePath}}/logs?range=1h{{if .Data.Filter}}&group={{.Data.Filter}}{{end}}{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.TimeRange "1h"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">1h</a>
            <a href="{{.BasePath}}/logs?range=12h{{if .Data.Filter}}&group={{.Data.Filter}}{{end}}{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.TimeRange "12h"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">12h</a>
            <a href="{{.BasePath}}/logs?range=24h{{if .Data.Filter}}&group={{.Data.Filter}}{{end}}{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.TimeRange "24h"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">24h</a>
            <a href="{{.BasePath}}/logs?range=7d{{if .Data.Filter}}&group={{.Data.Filter}}{{end}}{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.TimeRange "7d"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">7d</a>
        </div>
        <div class="h-4 w-px bg-line"></div>
        <div class="flex gap-1.5">
            <a href="{{.BasePath}}/logs?range={{.Data.TimeRange}}{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if not .Data.Filter}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">All</a>
            <a href="{{.BasePath}}/logs?range={{.Data.TimeRange}}&group=web{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.Filter "web"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">Web</a>
            <a href="{{.BasePath}}/logs?range={{.Data.TimeRange}}&group=api{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.Filter "api"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">API</a>
            <a href="{{.BasePath}}/logs?range={{.Data.TimeRange}}&group=badge{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.Filter "badge"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">Badge</a>
            <a href="{{.BasePath}}/logs?range={{.Data.TimeRange}}&group=auth{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.Filter "auth"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">Auth</a>
            <a href="{{.BasePath}}/logs?range={{.Data.TimeRange}}&group=status{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.Filter "status"}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">Status</a>
        </div>
    </div>

    {{if .Data.TopIPs}}
    <form method="GET" action="{{.BasePath}}/logs" class="mb-4">
        <input type="hidden" name="range" value="{{.Data.TimeRange}}">
        {{if .Data.Filter}}<input type="hidden" name="group" value="{{.Data.Filter}}">{{end}}
        <select name="ip" onchange="this.form.submit()"
                class="px-3 py-1.5 bg-surface border border-line rounded text-[12px] text-white focus:outline-none focus:border-brand/40 transition-colors">
            <option value="">All IPs</option>
            {{range .Data.TopIPs}}
            <option value="{{.}}" {{if eq . $.Data.ClientIP}}selected{{end}}>{{.}}</option>
            {{end}}
        </select>
    </form>
    {{end}}

    <div class="border border-line rounded-lg overflow-hidden">
        {{if and .Data.Result .Data.Result.Data}}
        <div class="overflow-x-auto">
            <table class="w-full min-w-[800px]">
                <thead>
                    <tr class="border-b border-line text-left">
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Time</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Method</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Path</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Status</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Latency</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">IP</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Group</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-line">
                    {{range .Data.Result.Data}}
                    <tr class="hover:bg-surface-200/20 transition-colors">
                        <td class="px-4 py-2.5 text-[12px] text-muted tabular-nums font-mono whitespace-nowrap">{{timeAgo .CreatedAt}}</td>
                        <td class="px-4 py-2.5"><span class="text-[10px] font-medium tracking-wide px-1.5 py-px rounded border border-line text-muted-light">{{.Method}}</span></td>
                        <td class="px-4 py-2.5 text-[12px] text-muted-light font-mono truncate max-w-[250px]" title="{{.Path}}">{{.Path}}</td>
                        <td class="px-4 py-2.5 text-[12px] font-mono tabular-nums {{httpStatusColor .StatusCode}}">{{.StatusCode}}</td>
                        <td class="px-4 py-2.5 text-[12px] text-muted tabular-nums font-mono">{{formatMs .LatencyMs}}</td>
                        <td class="px-4 py-2.5 text-[11px] font-mono"><a href="{{$.BasePath}}/logs?range={{$.Data.TimeRange}}{{if $.Data.Filter}}&group={{$.Data.Filter}}{{end}}&ip={{.ClientIP}}" class="text-muted hover:text-brand transition-colors">{{.ClientIP}}</a></td>
                        <td class="px-4 py-2.5"><span class="text-[10px] font-medium tracking-wide px-1.5 py-px rounded border border-line text-muted">{{.RouteGroup}}</span></td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{if gt .Data.Result.TotalPages 1}}
        <div class="px-4 py-2.5 border-t border-line flex items-center justify-between">
            <span class="text-[11px] text-muted tabular-nums">Page {{.Data.Result.Page}} / {{.Data.Result.TotalPages}} Â· {{.Data.Result.Total}} entries</span>
            <div class="flex gap-1">
                {{if gt .Data.Result.Page 1}}
                <a href="{{$.BasePath}}/logs?range={{.Data.TimeRange}}{{if .Data.Filter}}&group={{.Data.Filter}}{{end}}{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}&page={{sub .Data.Result.Page 1}}" class="inline-flex items-center justify-center w-6 h-6 text-muted-light hover:text-white border border-line rounded hover:border-line-light transition-colors"><svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></a>
                {{end}}
                {{if lt .Data.Result.Page .Data.Result.TotalPages}}
                <a href="{{$.BasePath}}/logs?range={{.Data.TimeRange}}{{if .Data.Filter}}&group={{.Data.Filter}}{{end}}{{if .Data.ClientIP}}&ip={{.Data.ClientIP}}{{end}}&page={{add .Data.Result.Page 1}}" class="inline-flex items-center justify-center w-6 h-6 text-muted-light hover:text-white border border-line rounded hover:border-line-light transition-colors"><svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></a>
                {{end}}
            </div>
        </div>
        {{end}}
        {{else}}
        <div class="px-4 py-16 text-center">
            <svg class="w-6 h-6 mx-auto text-muted/20 mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Z"/><polyline points="14 2 14 8 20 8"/></svg>
            <p class="text-muted text-[12px]">No request logs found</p>
        </div>
        {{end}}
    </div>
</div>
{{end}}
