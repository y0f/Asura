{{define "title"}}Incidents{{end}}
{{define "content"}}
<div>
    <h1 class="text-[15px] font-medium text-white mb-5">Incidents</h1>

    <div class="flex gap-1.5 mb-4">
        <a href="{{.BasePath}}/incidents" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if not .Data.Filter}}text-brand border-brand/30 bg-brand/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">All</a>
        <a href="{{.BasePath}}/incidents?status=open" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.Filter "open"}}text-red-400 border-red-500/30 bg-red-500/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">Open</a>
        <a href="{{.BasePath}}/incidents?status=acknowledged" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.Filter "acknowledged"}}text-yellow-400 border-yellow-500/30 bg-yellow-500/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">Acknowledged</a>
        <a href="{{.BasePath}}/incidents?status=resolved" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors {{if eq .Data.Filter "resolved"}}text-emerald-400 border-emerald-500/30 bg-emerald-500/[0.04]{{else}}text-muted border-line hover:text-muted-light{{end}}">Resolved</a>
    </div>

    <div class="border border-line rounded-lg overflow-hidden">
        {{if and .Data.Result .Data.Result.Data}}
        <div class="overflow-x-auto">
            <table class="w-full min-w-[700px]">
                <thead>
                    <tr class="border-b border-line text-left">
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Monitor</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Status</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Cause</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Duration</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Started</th>
                        <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest text-right"></th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-line">
                    {{range .Data.Result.Data}}
                    <tr class="hover:bg-surface-200/20 transition-colors">
                        <td class="px-4 py-3 text-[13px] text-white font-medium">{{.MonitorName}}</td>
                        <td class="px-4 py-3"><span class="text-[10px] font-medium tracking-wide px-1.5 py-px rounded border {{statusBg .Status}}">{{.Status}}</span></td>
                        <td class="px-4 py-3 text-[12px] text-muted truncate max-w-[200px]" title="{{.Cause}}">{{.Cause}}</td>
                        <td class="px-4 py-3 text-[12px] text-muted tabular-nums font-mono">{{incidentDuration .StartedAt .ResolvedAt}}</td>
                        <td class="px-4 py-3 text-[12px] text-muted/60">{{timeAgo .StartedAt}}</td>
                        <td class="px-4 py-3 text-right">
                            <a href="{{$.BasePath}}/incidents/{{.ID}}" class="text-[11px] text-muted hover:text-white transition-colors">View</a>
                            {{if index $.Perms "incidents.write"}}
                            <form method="POST" action="{{$.BasePath}}/incidents/{{.ID}}/delete" style="display:inline"
                                  x-data x-on:submit.prevent="if(confirm('Delete this incident?')) $el.submit()">
                                <button type="submit" class="text-[11px] text-muted hover:text-white transition-colors ml-3">Delete</button>
                            </form>
                            {{end}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{if gt .Data.Result.TotalPages 1}}
        <div class="px-4 py-2.5 border-t border-line flex items-center justify-between">
            <span class="text-[11px] text-muted tabular-nums">Page {{.Data.Result.Page}} / {{.Data.Result.TotalPages}} Â· {{.Data.Result.Total}} incidents</span>
            <div class="flex gap-1">
                {{if gt .Data.Result.Page 1}}
                <a href="{{$.BasePath}}/incidents?{{if .Data.Filter}}status={{.Data.Filter}}&{{end}}page={{sub .Data.Result.Page 1}}" class="inline-flex items-center justify-center w-6 h-6 text-muted-light hover:text-white border border-line rounded hover:border-line-light transition-colors"><svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></a>
                {{end}}
                {{if lt .Data.Result.Page .Data.Result.TotalPages}}
                <a href="{{$.BasePath}}/incidents?{{if .Data.Filter}}status={{.Data.Filter}}&{{end}}page={{add .Data.Result.Page 1}}" class="inline-flex items-center justify-center w-6 h-6 text-muted-light hover:text-white border border-line rounded hover:border-line-light transition-colors"><svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></a>
                {{end}}
            </div>
        </div>
        {{end}}
        {{else}}
        <div class="px-4 py-16 text-center">
            <svg class="w-6 h-6 mx-auto text-muted/20 mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            <p class="text-muted text-[12px]">No incidents found</p>
        </div>
        {{end}}
    </div>
</div>
{{end}}
