{{define "title"}}Monitors{{end}}
{{define "content"}}
<div>
    <div class="flex items-center justify-between mb-5">
        <h1 class="text-[15px] font-medium text-white">Monitors</h1>
        {{if index .Perms "monitors.write"}}
        <a href="{{$.BasePath}}/monitors/new" class="inline-flex items-center gap-1.5 px-3 py-1.5 bg-brand hover:bg-brand/85 text-white text-[12px] font-medium rounded transition-colors">
            <svg class="w-3 h-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 5v14m7-7H5"/></svg>
            New Monitor
        </a>
        {{end}}
    </div>

    <div x-data="{filter: ''}" x-cloak>
        <div class="flex gap-1.5 mb-4 overflow-x-auto pb-1">
            <button @click="filter=''" :class="filter==='' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">All</button>
            <button @click="filter='http'" :class="filter==='http' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">HTTP</button>
            <button @click="filter='tcp'" :class="filter==='tcp' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">TCP</button>
            <button @click="filter='dns'" :class="filter==='dns' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">DNS</button>
            <button @click="filter='icmp'" :class="filter==='icmp' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">ICMP</button>
            <button @click="filter='tls'" :class="filter==='tls' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">TLS</button>
            <button @click="filter='websocket'" :class="filter==='websocket' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">WebSocket</button>
            <button @click="filter='command'" :class="filter==='command' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">Command</button>
            <button @click="filter='heartbeat'" :class="filter==='heartbeat' ? 'text-brand border-brand/30 bg-brand/[0.04]' : 'text-muted border-line hover:text-muted-light'" class="px-2.5 py-1 text-[10px] uppercase tracking-wider border rounded transition-colors whitespace-nowrap">Heartbeat</button>
        </div>

        <div id="monitor-list" hx-get="" hx-trigger="every 30s" hx-select="#monitor-list" hx-swap="outerHTML" hx-push-url="false"
             class="border border-line rounded-lg overflow-hidden">
            {{if and .Data .Data.Data}}
            <div class="overflow-x-auto">
                <table class="w-full min-w-[640px]">
                    <thead>
                        <tr class="border-b border-line text-left">
                            <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Monitor</th>
                            <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Type</th>
                            <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Status</th>
                            <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest">Last Check</th>
                            <th class="px-4 py-2.5 text-[10px] font-medium text-muted uppercase tracking-widest text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-line">
                        {{range .Data.Data}}
                        <tr x-show="filter==='' || filter==='{{.Type}}'" class="hover:bg-surface-200/20 transition-colors">
                            <td class="px-4 py-3">
                                <a href="{{$.BasePath}}/monitors/{{.ID}}" class="text-[13px] text-muted-light hover:text-white transition-colors font-medium">{{.Name}}</a>
                                <div class="text-[11px] text-muted mt-0.5 truncate max-w-xs font-mono">{{.Target}}</div>
                            </td>
                            <td class="px-4 py-3">
                                <span class="text-[10px] text-brand uppercase tracking-wider">{{typeLabel .Type}}</span>
                            </td>
                            <td class="px-4 py-3">
                                <div class="flex items-center gap-2">
                                    <div class="w-1.5 h-1.5 rounded-full {{statusDot .Status}} {{if eq .Status "down"}}animate-pulse-dot{{end}}"></div>
                                    <span class="text-[12px] {{statusColor .Status}}">{{.Status}}</span>
                                </div>
                            </td>
                            <td class="px-4 py-3 text-[12px] text-muted">
                                {{if .LastCheckAt}}{{timeAgo .LastCheckAt}}{{else}}<span class="text-muted/40">—</span>{{end}}
                            </td>
                            <td class="px-4 py-3 text-right">
                                <div class="flex items-center justify-end gap-2">
                                    {{if index $.Perms "monitors.write"}}
                                    {{if .Enabled}}
                                    <form method="POST" action="{{$.BasePath}}/monitors/{{.ID}}/pause" class="inline">
                                        <button type="submit" class="text-muted hover:text-yellow-400 transition-colors" title="Pause">
                                            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                                        </button>
                                    </form>
                                    {{else}}
                                    <form method="POST" action="{{$.BasePath}}/monitors/{{.ID}}/resume" class="inline">
                                        <button type="submit" class="text-muted hover:text-emerald-400 transition-colors" title="Resume">
                                            <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                                        </button>
                                    </form>
                                    {{end}}
                                    {{end}}
                                    <a href="{{$.BasePath}}/monitors/{{.ID}}" class="text-[11px] text-muted hover:text-white transition-colors">View</a>
                                </div>
                            </td>
                        </tr>
                        {{end}}
                    </tbody>
                </table>
            </div>
            {{if gt .Data.TotalPages 1}}
            <div class="px-4 py-2.5 border-t border-line flex items-center justify-between">
                <span class="text-[11px] text-muted tabular-nums">Page {{.Data.Page}} / {{.Data.TotalPages}} · {{.Data.Total}} monitors</span>
                <div class="flex gap-1">
                    {{if gt .Data.Page 1}}
                    <a href="{{$.BasePath}}/monitors?page={{sub .Data.Page 1}}" class="inline-flex items-center justify-center w-6 h-6 text-muted-light hover:text-white border border-line rounded hover:border-line-light transition-colors"><svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></a>
                    {{end}}
                    {{if lt .Data.Page .Data.TotalPages}}
                    <a href="{{$.BasePath}}/monitors?page={{add .Data.Page 1}}" class="inline-flex items-center justify-center w-6 h-6 text-muted-light hover:text-white border border-line rounded hover:border-line-light transition-colors"><svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></a>
                    {{end}}
                </div>
            </div>
            {{end}}
            {{else}}
            <div class="px-4 py-16 text-center">
                <p class="text-muted text-[13px] mb-2">No monitors configured</p>
                <a href="{{$.BasePath}}/monitors/new" class="text-[12px] text-brand hover:text-brand/80 transition-colors">Create your first monitor</a>
            </div>
            {{end}}
        </div>
    </div>
    </div>
</div>
{{end}}
