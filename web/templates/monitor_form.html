{{define "title"}}{{.Title}}{{end}}
{{define "content"}}
{{$fd := .Data}}
{{$mon := $fd.Monitor}}
<div x-cloak x-data="{
    monitorType: '{{if $mon.Type}}{{$mon.Type}}{{else}}http{{end}}',
    advancedSettings: false,
    advancedAssertions: false,
    httpHeaders: {{$fd.HeadersJSON}},
    wsHeaders: {{$fd.WsHeadersJSON}},
    assertions: {{$fd.AssertionsJSON}},
    httpMethod: '{{if $fd.HTTP.Method}}{{$fd.HTTP.Method}}{{else}}GET{{end}}',
    authMethod: '{{$fd.HTTP.AuthMethod}}',
    operatorsFor(type) {
        switch(type) {
            case 'status_code': case 'response_time': case 'cert_expiry':
                return [['eq','='],['neq','!='],['gt','>'],['lt','<'],['gte','>='],['lte','<=']];
            case 'body_contains':
                return [['contains','contains'],['not_contains','not contains']];
            case 'body_regex':
                return [['matches','matches'],['not_matches','not matches']];
            case 'json_path':
                return [['eq','='],['neq','!='],['gt','>'],['lt','<'],['contains','contains'],['exists','exists']];
            case 'header':
                return [['eq','='],['neq','!='],['contains','contains'],['exists','exists']];
            case 'dns_record':
                return [['contains','contains'],['eq','=']];
            default:
                return [['eq','='],['neq','!=']];
        }
    },
    needsTarget(type) {
        return type === 'json_path' || type === 'header';
    },
    needsValue(op) {
        return op !== 'exists';
    }
}">
    <h1 class="text-[15px] font-medium text-white mb-5">{{.Title}}</h1>

    <form method="POST" action="{{if $mon.ID}}{{.BasePath}}/monitors/{{$mon.ID}}{{else}}{{.BasePath}}/monitors{{end}}" class="max-w-2xl space-y-4">

        <!-- Basic Info -->
        <div class="border border-line rounded-lg p-5 space-y-4">
            <div>
                <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Name</label>
                <input type="text" name="name" value="{{$mon.Name}}" required
                       class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
            </div>

            <div>
                <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Description</label>
                <textarea name="description" rows="2" placeholder="Optional description"
                          class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors resize-y">{{$mon.Description}}</textarea>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Type</label>
                    <select name="type" x-model="monitorType"
                            class="form-select w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors">
                        <option value="http">HTTP</option>
                        <option value="tcp">TCP</option>
                        <option value="dns">DNS</option>
                        <option value="icmp">ICMP</option>
                        <option value="tls">TLS</option>
                        <option value="websocket">WebSocket</option>
                        <option value="command">Command</option>
                        <option value="heartbeat">Heartbeat</option>
                    </select>
                </div>
                <div x-show="monitorType !== 'heartbeat'">
                    <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Target</label>
                    <input type="text" name="target" value="{{$mon.Target}}" placeholder="https://example.com"
                           class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div>
                    <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Interval (s)</label>
                    <input type="number" name="interval" value="{{if $mon.Interval}}{{$mon.Interval}}{{else}}60{{end}}" min="5" max="86400"
                           class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors tabular-nums">
                </div>
                <div>
                    <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Timeout (s)</label>
                    <input type="number" name="timeout" value="{{if $mon.Timeout}}{{$mon.Timeout}}{{else}}10{{end}}" min="1" max="300"
                           class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors tabular-nums">
                </div>
                <div>
                    <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Fail Threshold</label>
                    <input type="number" name="failure_threshold" value="{{if $mon.FailureThreshold}}{{$mon.FailureThreshold}}{{else}}3{{end}}" min="1"
                           class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors tabular-nums">
                </div>
                <div>
                    <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Pass Threshold</label>
                    <input type="number" name="success_threshold" value="{{if $mon.SuccessThreshold}}{{$mon.SuccessThreshold}}{{else}}1{{end}}" min="1"
                           class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors tabular-nums">
                </div>
            </div>

            <div>
                <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Tags</label>
                <input type="text" name="tags" value="{{range $i, $t := $mon.Tags}}{{if $i}}, {{end}}{{$t}}{{end}}" placeholder="production, api"
                       class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
            </div>

            {{if $fd.Groups}}
            <div>
                <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Group</label>
                <select name="group_id"
                        class="form-select w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors">
                    <option value="">No group</option>
                    {{range $fd.Groups}}
                    <option value="{{.ID}}" {{if and $mon.GroupID (eq (deref $mon.GroupID) .ID)}}selected{{end}}>{{.Name}}</option>
                    {{end}}
                </select>
            </div>
            {{end}}

            {{if $fd.NotificationChannels}}
            <div>
                <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Notification Channels</label>
                <p class="text-[10px] text-muted mb-2">Select which channels receive alerts for this monitor. Leave all unchecked to use all channels.</p>
                <div class="space-y-1.5">
                    {{range $fd.NotificationChannels}}
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" name="notification_channel_ids[]" value="{{.ID}}" {{if inSlice .ID $fd.SelectedChannelIDs}}checked{{end}}
                               class="w-3.5 h-3.5 rounded-sm bg-surface border-line text-brand focus:ring-brand/30 focus:ring-offset-0">
                        <span class="text-[12px] text-muted-light">{{.Name}} <span class="text-muted">({{.Type}})</span></span>
                    </label>
                    {{end}}
                </div>
            </div>
            {{end}}

            <div class="flex items-center flex-wrap gap-5">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="track_changes" {{if $mon.TrackChanges}}checked{{end}}
                           class="w-3.5 h-3.5 rounded-sm bg-surface border-line text-brand focus:ring-brand/30 focus:ring-offset-0">
                    <span class="text-[12px] text-muted-light">Track changes</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="public" {{if $mon.Public}}checked{{end}}
                           class="w-3.5 h-3.5 rounded-sm bg-surface border-line text-brand focus:ring-brand/30 focus:ring-offset-0">
                    <span class="text-[12px] text-muted-light">Public</span>
                </label>
                <label class="flex items-center gap-2 cursor-pointer">
                    <input type="checkbox" name="upside_down" {{if $mon.UpsideDown}}checked{{end}}
                           class="w-3.5 h-3.5 rounded-sm bg-surface border-line text-brand focus:ring-brand/30 focus:ring-offset-0">
                    <span class="text-[12px] text-muted-light">Upside-down mode</span>
                </label>
            </div>

            <div>
                <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Resend Notification Interval (s)</label>
                <input type="number" name="resend_interval" value="{{$mon.ResendInterval}}" min="0" placeholder="0 = disabled"
                       class="w-full max-w-[200px] px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors tabular-nums">
                <p class="text-[10px] text-muted mt-1">Resend notification every N seconds while down (0 = disabled)</p>
            </div>
        </div>

        <!-- Settings -->
        <div class="border border-line rounded-lg p-5" x-show="monitorType !== 'heartbeat' && monitorType !== 'icmp'" x-cloak>
            <div class="flex items-center justify-between mb-4">
                <span class="text-[11px] text-muted uppercase tracking-widest">Settings</span>
                <button type="button" @click="advancedSettings = !advancedSettings"
                        class="text-[11px] text-brand hover:text-brand/80 transition-colors">
                    <span x-text="advancedSettings ? 'Form Mode' : 'Advanced (JSON)'"></span>
                </button>
            </div>

            <input type="hidden" name="settings_mode" :value="advancedSettings ? 'json' : 'form'">

            <!-- Advanced JSON mode -->
            <div x-show="advancedSettings" x-cloak>
                <textarea name="settings_json" rows="8" placeholder="{}"
                          class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] font-mono placeholder-muted focus:outline-none focus:border-brand/30 transition-colors resize-y">{{$fd.SettingsJSON}}</textarea>
            </div>

            <!-- Form mode -->
            <div x-show="!advancedSettings" class="space-y-4">

                <!-- HTTP Settings -->
                <div x-show="monitorType === 'http'" x-cloak class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Method</label>
                            <select name="settings_method" x-model="httpMethod"
                                    class="form-select w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="PATCH">PATCH</option>
                                <option value="DELETE">DELETE</option>
                                <option value="HEAD">HEAD</option>
                                <option value="OPTIONS">OPTIONS</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Expected Status</label>
                            <input type="number" name="settings_expected_status" value="{{if $fd.HTTP.ExpectedStatus}}{{$fd.HTTP.ExpectedStatus}}{{end}}" placeholder="200"
                                   class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors tabular-nums">
                        </div>
                    </div>

                    <!-- Body Encoding + Body -->
                    <div x-show="httpMethod === 'POST' || httpMethod === 'PUT' || httpMethod === 'PATCH'" x-cloak class="space-y-4">
                        <div>
                            <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Body Encoding</label>
                            <select name="settings_body_encoding"
                                    class="form-select w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors">
                                <option value="json" {{if eq $fd.HTTP.BodyEncoding "json"}}selected{{end}}>JSON</option>
                                <option value="xml" {{if eq $fd.HTTP.BodyEncoding "xml"}}selected{{end}}>XML</option>
                                <option value="form" {{if eq $fd.HTTP.BodyEncoding "form"}}selected{{end}}>Form</option>
                                <option value="raw" {{if eq $fd.HTTP.BodyEncoding "raw"}}selected{{end}}>Raw</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Body</label>
                            <textarea name="settings_body" rows="3" placeholder="Request body"
                                      class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] font-mono placeholder-muted focus:outline-none focus:border-brand/30 transition-colors resize-y">{{$fd.HTTP.Body}}</textarea>
                        </div>
                    </div>

                    <!-- Headers -->
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Headers</label>
                        <div class="space-y-2">
                            <template x-for="(h, i) in httpHeaders" :key="i">
                                <div class="flex gap-2">
                                    <input type="text" :name="'settings_header_key[]'" x-model="h.key" placeholder="Header Name"
                                           class="flex-1 px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                                    <input type="text" :name="'settings_header_value[]'" x-model="h.value" placeholder="Value"
                                           class="flex-1 px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                                    <button type="button" @click="httpHeaders.splice(i, 1)"
                                            class="px-2 text-red-400 hover:text-red-300 transition-colors text-[16px]">&times;</button>
                                </div>
                            </template>
                        </div>
                        <button type="button" @click="httpHeaders.push({key:'', value:''})"
                                class="mt-2 text-[12px] text-brand hover:text-brand/80 transition-colors">+ Add Header</button>
                    </div>

                    <!-- Authentication -->
                    <div class="space-y-3">
                        <div>
                            <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Authentication</label>
                            <select name="settings_auth_method" x-model="authMethod"
                                    class="form-select w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors">
                                <option value="none">None</option>
                                <option value="basic">Basic Auth</option>
                                <option value="bearer">Bearer Token</option>
                            </select>
                        </div>
                        <div x-show="authMethod === 'basic'" x-cloak class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Username</label>
                                <input type="text" name="settings_basic_auth_user" value="{{$fd.HTTP.BasicAuthUser}}"
                                       class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                            </div>
                            <div>
                                <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Password</label>
                                <input type="password" name="settings_basic_auth_pass" value="{{$fd.HTTP.BasicAuthPass}}"
                                       class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                            </div>
                        </div>
                        <div x-show="authMethod === 'bearer'" x-cloak>
                            <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Token</label>
                            <input type="password" name="settings_bearer_token" value="{{$fd.HTTP.BearerToken}}"
                                   class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                        </div>
                    </div>

                    <!-- Max Redirects -->
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Max Redirects</label>
                        <input type="number" name="settings_max_redirects" value="{{$fd.MaxRedirects}}" min="0" max="30"
                               class="w-full max-w-[200px] px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors tabular-nums">
                        <p class="text-[10px] text-muted mt-1">0 = don't follow redirects</p>
                    </div>

                    <!-- Checkboxes -->
                    <div class="flex items-center flex-wrap gap-5">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="settings_skip_tls_verify" {{if $fd.HTTP.SkipTLSVerify}}checked{{end}}
                                   class="w-3.5 h-3.5 rounded-sm bg-surface border-line text-brand focus:ring-brand/30 focus:ring-offset-0">
                            <span class="text-[12px] text-muted-light">Ignore TLS/SSL errors</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="settings_cache_buster" {{if $fd.HTTP.CacheBuster}}checked{{end}}
                                   class="w-3.5 h-3.5 rounded-sm bg-surface border-line text-brand focus:ring-brand/30 focus:ring-offset-0">
                            <span class="text-[12px] text-muted-light">Cache buster</span>
                        </label>
                    </div>
                </div>

                <!-- TCP Settings -->
                <div x-show="monitorType === 'tcp'" x-cloak class="space-y-4">
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Send Data</label>
                        <input type="text" name="settings_send_data" value="{{$fd.TCP.SendData}}" placeholder="Optional data to send"
                               class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                    </div>
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Expect Data</label>
                        <input type="text" name="settings_expect_data" value="{{$fd.TCP.ExpectData}}" placeholder="Expected response"
                               class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                    </div>
                </div>

                <!-- DNS Settings -->
                <div x-show="monitorType === 'dns'" x-cloak class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Record Type</label>
                            <select name="settings_record_type"
                                    class="form-select w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors">
                                <option value="A" {{if eq $fd.DNS.RecordType "A"}}selected{{end}}>A</option>
                                <option value="AAAA" {{if eq $fd.DNS.RecordType "AAAA"}}selected{{end}}>AAAA</option>
                                <option value="CNAME" {{if eq $fd.DNS.RecordType "CNAME"}}selected{{end}}>CNAME</option>
                                <option value="MX" {{if eq $fd.DNS.RecordType "MX"}}selected{{end}}>MX</option>
                                <option value="TXT" {{if eq $fd.DNS.RecordType "TXT"}}selected{{end}}>TXT</option>
                                <option value="NS" {{if eq $fd.DNS.RecordType "NS"}}selected{{end}}>NS</option>
                                <option value="SOA" {{if eq $fd.DNS.RecordType "SOA"}}selected{{end}}>SOA</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">DNS Server</label>
                            <input type="text" name="settings_dns_server" value="{{$fd.DNS.Server}}" placeholder="Optional (e.g. 8.8.8.8)"
                                   class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                        </div>
                    </div>
                </div>

                <!-- TLS Settings -->
                <div x-show="monitorType === 'tls'" x-cloak class="space-y-4">
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Warning Days Before Expiry</label>
                        <input type="number" name="settings_warn_days_before" value="{{if $fd.TLS.WarnDaysBefore}}{{$fd.TLS.WarnDaysBefore}}{{else}}30{{end}}" min="1" max="365"
                               class="w-full max-w-[200px] px-3 py-2 bg-surface border border-line rounded text-white text-[13px] focus:outline-none focus:border-brand/30 transition-colors tabular-nums">
                    </div>
                </div>

                <!-- WebSocket Settings -->
                <div x-show="monitorType === 'websocket'" x-cloak class="space-y-4">
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Headers</label>
                        <div class="space-y-2">
                            <template x-for="(h, i) in wsHeaders" :key="i">
                                <div class="flex gap-2">
                                    <input type="text" :name="'settings_ws_header_key[]'" x-model="h.key" placeholder="Header Name"
                                           class="flex-1 px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                                    <input type="text" :name="'settings_ws_header_value[]'" x-model="h.value" placeholder="Value"
                                           class="flex-1 px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                                    <button type="button" @click="wsHeaders.splice(i, 1)"
                                            class="px-2 text-red-400 hover:text-red-300 transition-colors text-[16px]">&times;</button>
                                </div>
                            </template>
                        </div>
                        <button type="button" @click="wsHeaders.push({key:'', value:''})"
                                class="mt-2 text-[12px] text-brand hover:text-brand/80 transition-colors">+ Add Header</button>
                    </div>
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Send Message</label>
                        <input type="text" name="settings_send_message" value="{{$fd.WS.SendMessage}}" placeholder="Optional message to send"
                               class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                    </div>
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Expect Reply</label>
                        <input type="text" name="settings_expect_reply" value="{{$fd.WS.ExpectReply}}" placeholder="Expected reply"
                               class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                    </div>
                </div>

                <!-- Command Settings -->
                <div x-show="monitorType === 'command'" x-cloak class="space-y-4">
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Command</label>
                        <input type="text" name="settings_command" value="{{$fd.Cmd.Command}}" placeholder="/usr/bin/check-health"
                               class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                    </div>
                    <div>
                        <label class="block text-[11px] text-muted uppercase tracking-widest mb-1.5">Arguments</label>
                        <input type="text" name="settings_args" value="{{range $i, $a := $fd.Cmd.Args}}{{if $i}}, {{end}}{{$a}}{{end}}" placeholder="--verbose, --timeout=5"
                               class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                        <p class="text-[10px] text-muted mt-1">Comma-separated</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Assertions -->
        <div class="border border-line rounded-lg p-5">
            <div class="flex items-center justify-between mb-4">
                <span class="text-[11px] text-muted uppercase tracking-widest">Assertions</span>
                <button type="button" @click="advancedAssertions = !advancedAssertions"
                        class="text-[11px] text-brand hover:text-brand/80 transition-colors">
                    <span x-text="advancedAssertions ? 'Form Mode' : 'Advanced (JSON)'"></span>
                </button>
            </div>

            <input type="hidden" name="assertions_mode" :value="advancedAssertions ? 'json' : 'form'">

            <!-- Advanced JSON mode -->
            <div x-show="advancedAssertions" x-cloak>
                <textarea name="assertions_json" rows="6" placeholder="[]"
                          class="w-full px-3 py-2 bg-surface border border-line rounded text-white text-[13px] font-mono placeholder-muted focus:outline-none focus:border-brand/30 transition-colors resize-y">{{$fd.AssertionsRaw}}</textarea>
            </div>

            <!-- Form mode -->
            <div x-show="!advancedAssertions">
                <input type="hidden" name="assertion_count" :value="assertions.length">

                <div x-show="assertions.length === 0" class="text-[12px] text-muted py-2">No assertions configured</div>

                <div class="space-y-3">
                    <template x-for="(a, i) in assertions" :key="i">
                        <div class="border border-line/50 rounded p-3 space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-[11px] text-muted" x-text="'Assertion ' + (i+1)"></span>
                                <button type="button" @click="assertions.splice(i, 1)"
                                        class="text-red-400 hover:text-red-300 transition-colors text-[14px]">&times;</button>
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <div>
                                    <label class="block text-[10px] text-muted uppercase tracking-widest mb-1">Type</label>
                                    <select :name="'assertion_type_' + i" x-model="a.type"
                                            class="form-select w-full px-3 py-1.5 bg-surface border border-line rounded text-white text-[12px] focus:outline-none focus:border-brand/30 transition-colors">
                                        <option value="status_code">Status Code</option>
                                        <option value="body_contains">Body Contains</option>
                                        <option value="body_regex">Body Regex</option>
                                        <option value="json_path">JSON Path</option>
                                        <option value="header">Header</option>
                                        <option value="response_time">Response Time</option>
                                        <option value="cert_expiry">Cert Expiry</option>
                                        <option value="dns_record">DNS Record</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] text-muted uppercase tracking-widest mb-1">Operator</label>
                                    <select :name="'assertion_operator_' + i" x-model="a.operator"
                                            class="form-select w-full px-3 py-1.5 bg-surface border border-line rounded text-white text-[12px] focus:outline-none focus:border-brand/30 transition-colors">
                                        <template x-for="op in operatorsFor(a.type)" :key="op[0]">
                                            <option :value="op[0]" x-text="op[1]"></option>
                                        </template>
                                    </select>
                                </div>
                            </div>
                            <div class="grid gap-3" :class="needsTarget(a.type) ? 'grid-cols-2' : 'grid-cols-1'">
                                <div x-show="needsTarget(a.type)">
                                    <label class="block text-[10px] text-muted uppercase tracking-widest mb-1">Target</label>
                                    <input type="text" :name="'assertion_target_' + i" x-model="a.target" placeholder="e.g. $.status or Content-Type"
                                           class="w-full px-3 py-1.5 bg-surface border border-line rounded text-white text-[12px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                                </div>
                                <div x-show="needsValue(a.operator)">
                                    <label class="block text-[10px] text-muted uppercase tracking-widest mb-1">Value</label>
                                    <input type="text" :name="'assertion_value_' + i" x-model="a.value" placeholder="Expected value"
                                           class="w-full px-3 py-1.5 bg-surface border border-line rounded text-white text-[12px] placeholder-muted focus:outline-none focus:border-brand/30 transition-colors">
                                </div>
                            </div>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" :name="'assertion_degraded_' + i" :checked="a.degraded"
                                       class="w-3 h-3 rounded-sm bg-surface border-line text-brand focus:ring-brand/30 focus:ring-offset-0">
                                <span class="text-[11px] text-muted-light">Soft (mark as degraded instead of down)</span>
                            </label>
                        </div>
                    </template>
                </div>

                <button type="button" @click="assertions.push({type:'status_code', operator:'eq', target:'', value:'', degraded:false})"
                        class="mt-3 text-[12px] text-brand hover:text-brand/80 transition-colors">+ Add Assertion</button>
            </div>
        </div>

        <div class="flex items-center gap-3">
            <button type="submit" class="px-5 py-2 bg-brand hover:bg-brand/85 text-white text-[13px] font-medium rounded transition-colors">
                {{if $mon.ID}}Update{{else}}Create{{end}}
            </button>
            <a href="{{.BasePath}}/monitors{{if $mon.ID}}/{{$mon.ID}}{{end}}" class="text-[13px] text-muted hover:text-muted-light transition-colors">Cancel</a>
        </div>
    </form>
</div>
{{end}}
