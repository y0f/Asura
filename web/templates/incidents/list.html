{{define "title"}}Incidents{{end}}
{{define "content"}}
<div>
    <h1 class="text-[15px] font-medium text-white mb-5">Incidents</h1>

    <div class="flex gap-1.5 mb-3">
        <a href="{{.BasePath}}/incidents{{if .Data.Search}}?q={{.Data.Search}}{{end}}" class="filter-tab {{if not .Data.Filter}}filter-active{{else}}filter-inactive{{end}}">All</a>
        <a href="{{.BasePath}}/incidents?status=open{{if .Data.Search}}&q={{.Data.Search}}{{end}}" class="filter-tab {{if eq .Data.Filter "open"}}text-red-400 border-red-500/30 bg-red-500/[0.04]{{else}}filter-inactive{{end}}">Open</a>
        <a href="{{.BasePath}}/incidents?status=acknowledged{{if .Data.Search}}&q={{.Data.Search}}{{end}}" class="filter-tab {{if eq .Data.Filter "acknowledged"}}text-yellow-400 border-yellow-500/30 bg-yellow-500/[0.04]{{else}}filter-inactive{{end}}">Acknowledged</a>
        <a href="{{.BasePath}}/incidents?status=resolved{{if .Data.Search}}&q={{.Data.Search}}{{end}}" class="filter-tab {{if eq .Data.Filter "resolved"}}text-emerald-400 border-emerald-500/30 bg-emerald-500/[0.04]{{else}}filter-inactive{{end}}">Resolved</a>
    </div>

    <form method="GET" action="{{.BasePath}}/incidents" class="mb-4">
        {{if .Data.Filter}}<input type="hidden" name="status" value="{{.Data.Filter}}">{{end}}
        <div class="relative max-w-xs">
            <svg class="absolute left-2.5 top-1/2 -translate-y-1/2 w-3.5 h-3.5 text-muted pointer-events-none" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input type="text" name="q" value="{{.Data.Search}}" placeholder="Search incidents..."
                   class="w-full pl-8 pr-3 py-1.5 bg-transparent border border-line rounded text-[12px] text-white placeholder-muted/50 focus:outline-hidden focus:border-brand/40 transition-colors">
        </div>
    </form>

    <div class="border border-line rounded-lg overflow-hidden">
        {{if and .Data.Result .Data.Result.Data}}
        <div class="overflow-x-auto">
            <table class="w-full min-w-[700px]">
                <thead>
                    <tr class="border-b border-line text-left">
                        <th class="th">Monitor</th>
                        <th class="th">Status</th>
                        <th class="th">Cause</th>
                        <th class="th">Duration</th>
                        <th class="th">Started</th>
                        <th class="th text-right"></th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-line">
                    {{range .Data.Result.Data}}
                    <tr class="hover:bg-surface-200/20 transition-colors">
                        <td class="px-4 py-3 text-[13px] text-white font-medium">{{.MonitorName}}</td>
                        <td class="px-4 py-3"><span class="text-[10px] font-medium tracking-wide px-1.5 py-px rounded border {{statusBg .Status}}">{{.Status}}</span></td>
                        <td class="px-4 py-3 text-[12px] text-muted truncate max-w-[200px]" title="{{.Cause}}">{{.Cause}}</td>
                        <td class="px-4 py-3 text-[12px] text-muted tabular-nums font-mono">{{incidentDuration .StartedAt .ResolvedAt}}</td>
                        <td class="px-4 py-3 text-[12px] text-muted/60">{{timeAgo .StartedAt}}</td>
                        <td class="px-4 py-3 text-right">
                            <div class="flex items-center justify-end gap-2">
                                <a href="{{$.BasePath}}/incidents/{{.ID}}" class="text-muted hover:text-white transition-colors" title="View">
                                    <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                </a>
                                {{if index $.Perms "incidents.write"}}
                                <form method="POST" action="{{$.BasePath}}/incidents/{{.ID}}/delete" style="display:inline"
                                      x-data x-on:submit.prevent="if(confirm('Delete this incident?')) $el.submit()">
                                    <button type="submit" class="text-muted hover:text-red-400 transition-colors" title="Delete">
                                        <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                                    </button>
                                </form>
                                {{end}}
                            </div>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{if gt .Data.Result.TotalPages 1}}
        <div class="px-4 py-2.5 border-t border-line flex items-center justify-between">
            <span class="text-[11px] text-muted tabular-nums">Page {{.Data.Result.Page}} / {{.Data.Result.TotalPages}} Â· {{.Data.Result.Total}} incidents</span>
            <div class="flex gap-1">
                {{if gt .Data.Result.Page 1}}
                <a href="{{$.BasePath}}/incidents?page={{sub .Data.Result.Page 1}}{{if .Data.Filter}}&status={{.Data.Filter}}{{end}}{{if .Data.Search}}&q={{.Data.Search}}{{end}}" class="inline-flex items-center justify-center w-6 h-6 text-muted-light hover:text-white border border-line rounded hover:border-line-light transition-colors"><svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m15 18-6-6 6-6"/></svg></a>
                {{end}}
                {{if lt .Data.Result.Page .Data.Result.TotalPages}}
                <a href="{{$.BasePath}}/incidents?page={{add .Data.Result.Page 1}}{{if .Data.Filter}}&status={{.Data.Filter}}{{end}}{{if .Data.Search}}&q={{.Data.Search}}{{end}}" class="inline-flex items-center justify-center w-6 h-6 text-muted-light hover:text-white border border-line rounded hover:border-line-light transition-colors"><svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="m9 18 6-6-6-6"/></svg></a>
                {{end}}
            </div>
        </div>
        {{end}}
        {{else}}
        <div class="px-4 py-16 text-center">
            <svg class="w-6 h-6 mx-auto text-muted/20 mb-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
            {{if or .Data.Search .Data.Filter}}
            <p class="text-muted text-[12px]">No incidents match your search</p>
            {{else}}
            <p class="text-muted text-[12px]">No incidents found</p>
            {{end}}
        </div>
        {{end}}
    </div>
</div>
{{end}}
