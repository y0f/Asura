{{define "title"}}{{.Data.Monitor.Name}}{{end}}
{{define "content"}}
{{$mon := .Data.Monitor}}
<div id="monitor-detail" hx-get="" hx-trigger="every 15s" hx-select="#monitor-detail" hx-swap="outerHTML" hx-push-url="false">
    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-4 mb-5">
        <div>
            <div class="flex items-center gap-2 mb-1.5">
                <a href="/monitors" class="text-xs text-gray-500 hover:text-gray-300 transition-colors">&larr; Monitors</a>
            </div>
            <div class="flex items-center gap-2.5">
                <div class="w-3 h-3 rounded-full {{statusDot $mon.Status}} {{if eq $mon.Status "down"}}animate-pulse-dot{{end}}"></div>
                <h1 class="text-xl font-semibold text-white">{{$mon.Name}}</h1>
                <span class="text-xs px-2.5 py-0.5 rounded-full border {{statusBg $mon.Status}}">{{$mon.Status}}</span>
                {{if not $mon.Enabled}}
                <span class="text-xs px-2.5 py-0.5 rounded-full border bg-gray-500/10 text-gray-400 border-gray-500/20">paused</span>
                {{end}}
            </div>
            <div class="text-xs text-gray-500 mt-1.5 ml-5.5">{{typeLabel $mon.Type}} &middot; {{$mon.Target}} &middot; every {{$mon.Interval}}s &middot; timeout {{$mon.Timeout}}s</div>
        </div>
        {{if index $.Perms "monitors.write"}}
        <div class="flex items-center gap-2 flex-shrink-0">
            {{if $mon.Enabled}}
            <form method="POST" action="/monitors/{{$mon.ID}}/pause">
                <button type="submit" class="px-3 py-1.5 text-xs text-gray-400 border border-border rounded-lg hover:bg-surface-200 hover:border-border-light transition-all duration-150">Pause</button>
            </form>
            {{else}}
            <form method="POST" action="/monitors/{{$mon.ID}}/resume">
                <button type="submit" class="px-3 py-1.5 text-xs text-emerald-400 border border-emerald-500/20 rounded-lg hover:bg-emerald-500/10 transition-all duration-150">Resume</button>
            </form>
            {{end}}
            <a href="/monitors/{{$mon.ID}}/edit" class="px-3 py-1.5 text-xs text-indigo-400 border border-indigo-500/20 rounded-lg hover:bg-indigo-500/10 transition-all duration-150">Edit</a>
            <form method="POST" action="/monitors/{{$mon.ID}}/delete" x-data @submit.prevent="if(confirm('Delete this monitor?')) $el.submit()">
                <button type="submit" class="px-3 py-1.5 text-xs text-red-400 border border-red-500/20 rounded-lg hover:bg-red-500/10 transition-all duration-150">Delete</button>
            </form>
        </div>
        {{end}}
    </div>

    {{if .Data.OpenIncident}}
    <div class="mb-5 p-3.5 bg-red-500/10 border border-red-500/20 rounded-xl flex items-center gap-2.5">
        <svg class="w-4 h-4 text-red-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"/></svg>
        <div class="text-sm text-red-400">
            Active incident: {{.Data.OpenIncident.Cause}}
            <a href="/incidents/{{.Data.OpenIncident.ID}}" class="underline hover:text-red-300 ml-1">View &rarr;</a>
        </div>
    </div>
    {{end}}

    <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 mb-5">
        <div class="bg-surface-100 border border-border rounded-xl p-4 hover:border-border-light transition-colors duration-200">
            <div class="text-xs text-gray-500 mb-1.5">Uptime (24h)</div>
            <div class="text-lg font-bold {{uptimeColor .Data.Uptime24h}} tabular-nums">{{uptimeFmt .Data.Uptime24h}}</div>
        </div>
        <div class="bg-surface-100 border border-border rounded-xl p-4 hover:border-border-light transition-colors duration-200">
            <div class="text-xs text-gray-500 mb-1.5">Uptime (7d)</div>
            <div class="text-lg font-bold {{uptimeColor .Data.Uptime7d}} tabular-nums">{{uptimeFmt .Data.Uptime7d}}</div>
        </div>
        <div class="bg-surface-100 border border-border rounded-xl p-4 hover:border-border-light transition-colors duration-200">
            <div class="text-xs text-gray-500 mb-1.5">Uptime (30d)</div>
            <div class="text-lg font-bold {{uptimeColor .Data.Uptime30d}} tabular-nums">{{uptimeFmt .Data.Uptime30d}}</div>
        </div>
        <div class="bg-surface-100 border border-border rounded-xl p-4 hover:border-border-light transition-colors duration-200">
            <div class="text-xs text-gray-500 mb-1.5">Checks (24h)</div>
            <div class="text-lg font-bold text-white tabular-nums">{{.Data.TotalChecks}}</div>
            {{if gt .Data.TotalChecks 0}}
            <div class="flex items-center gap-2 mt-1">
                <span class="text-xs text-emerald-400">{{.Data.UpChecks}} up</span>
                {{if gt .Data.DownChecks 0}}<span class="text-xs text-red-400">{{.Data.DownChecks}} down</span>{{end}}
            </div>
            {{end}}
        </div>
    </div>

    {{if or (eq $mon.Type "http") (eq $mon.Type "tcp") (eq $mon.Type "dns") (eq $mon.Type "icmp") (eq $mon.Type "websocket")}}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-5">
        <div class="bg-surface-100 border border-border rounded-xl p-4">
            <div class="text-xs text-gray-500 mb-1.5">Response p50</div>
            <div class="text-lg font-bold text-white tabular-nums">{{formatFloat .Data.P50}}</div>
        </div>
        <div class="bg-surface-100 border border-border rounded-xl p-4">
            <div class="text-xs text-gray-500 mb-1.5">Response p95</div>
            <div class="text-lg font-bold text-white tabular-nums">{{formatFloat .Data.P95}}</div>
        </div>
        <div class="bg-surface-100 border border-border rounded-xl p-4">
            <div class="text-xs text-gray-500 mb-1.5">Response p99</div>
            <div class="text-lg font-bold text-white tabular-nums">{{formatFloat .Data.P99}}</div>
        </div>
    </div>
    {{end}}

    {{if and .Data.LatestCheck (eq $mon.Type "tls")}}
    {{if .Data.LatestCheck.CertExpiry}}
    <div class="bg-surface-100 border border-border rounded-xl p-4 mb-5">
        <div class="flex items-center justify-between">
            <div>
                <div class="text-xs text-gray-500 mb-1">TLS Certificate Expiry</div>
                <div class="text-sm font-medium {{certColor .Data.LatestCheck.CertExpiry}}">
                    {{certDays .Data.LatestCheck.CertExpiry}} days remaining
                </div>
            </div>
            <div class="text-xs text-gray-500">
                {{.Data.LatestCheck.CertExpiry.Format "Jan 2, 2006 15:04 UTC"}}
            </div>
        </div>
    </div>
    {{end}}
    {{end}}

    {{if and .Data.LatestCheck (eq $mon.Type "dns")}}
    {{$records := parseDNS .Data.LatestCheck.DNSRecords}}
    {{if $records}}
    <div class="bg-surface-100 border border-border rounded-xl p-4 mb-5">
        <div class="text-xs text-gray-500 mb-2">DNS Records</div>
        <div class="space-y-1">
            {{range $records}}
            <div class="text-sm text-gray-300 font-mono">{{.}}</div>
            {{end}}
        </div>
    </div>
    {{end}}
    {{end}}

    <div class="bg-surface-100 border border-border rounded-xl p-4 mb-5">
        <div class="text-xs text-gray-500 mb-3">Configuration</div>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-x-6 gap-y-2 text-sm">
            <div><span class="text-gray-500">Interval:</span> <span class="text-gray-300">{{$mon.Interval}}s</span></div>
            <div><span class="text-gray-500">Timeout:</span> <span class="text-gray-300">{{$mon.Timeout}}s</span></div>
            <div><span class="text-gray-500">Failure threshold:</span> <span class="text-gray-300">{{$mon.FailureThreshold}}</span></div>
            <div><span class="text-gray-500">Success threshold:</span> <span class="text-gray-300">{{$mon.SuccessThreshold}}</span></div>
            <div><span class="text-gray-500">Enabled:</span> <span class="{{if $mon.Enabled}}text-emerald-400{{else}}text-gray-500{{end}}">{{if $mon.Enabled}}yes{{else}}no{{end}}</span></div>
            {{if $mon.TrackChanges}}<div><span class="text-gray-500">Track changes:</span> <span class="text-indigo-400">yes</span></div>{{end}}
            {{if $mon.Tags}}<div class="col-span-2 md:col-span-3"><span class="text-gray-500">Tags:</span> <span class="text-gray-300">{{range $i, $t := $mon.Tags}}{{if $i}}, {{end}}{{$t}}{{end}}</span></div>{{end}}
        </div>
    </div>

    <div class="bg-surface-100 border border-border rounded-xl mb-5 overflow-hidden">
        <div class="px-5 py-3.5 border-b border-border">
            <h2 class="text-sm font-medium text-gray-300">Recent Checks</h2>
        </div>
        {{if and $.Data.Checks $.Data.Checks.Data}}
        <div class="overflow-x-auto">
            <table class="w-full min-w-[600px]">
                <thead>
                    <tr class="border-b border-border text-left">
                        <th class="px-5 py-2.5 text-xs font-medium text-gray-500 uppercase">Status</th>
                        <th class="px-5 py-2.5 text-xs font-medium text-gray-500 uppercase">Response</th>
                        {{if or (eq $mon.Type "http") (eq $mon.Type "websocket")}}
                        <th class="px-5 py-2.5 text-xs font-medium text-gray-500 uppercase">Code</th>
                        {{end}}
                        {{if eq $mon.Type "tls"}}
                        <th class="px-5 py-2.5 text-xs font-medium text-gray-500 uppercase">Cert Expiry</th>
                        {{end}}
                        <th class="px-5 py-2.5 text-xs font-medium text-gray-500 uppercase">Message</th>
                        <th class="px-5 py-2.5 text-xs font-medium text-gray-500 uppercase">Time</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-border">
                    {{range $.Data.Checks.Data}}
                    <tr class="hover:bg-surface-200/40 transition-colors duration-150">
                        <td class="px-5 py-2.5">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 rounded-full {{statusDot .Status}}"></div>
                                <span class="text-xs {{statusColor .Status}}">{{.Status}}</span>
                            </div>
                        </td>
                        <td class="px-5 py-2.5 text-xs text-gray-300 tabular-nums">{{formatMs .ResponseTime}}</td>
                        {{if or (eq $mon.Type "http") (eq $mon.Type "websocket")}}
                        <td class="px-5 py-2.5 text-xs tabular-nums {{if .StatusCode}}{{httpStatusColor .StatusCode}}{{else}}text-gray-600{{end}}">{{if .StatusCode}}{{.StatusCode}}{{else}}-{{end}}</td>
                        {{end}}
                        {{if eq $mon.Type "tls"}}
                        <td class="px-5 py-2.5 text-xs {{certColor .CertExpiry}}">{{if .CertExpiry}}{{certDays .CertExpiry}}d{{else}}-{{end}}</td>
                        {{end}}
                        <td class="px-5 py-2.5 text-xs text-gray-500 truncate max-w-xs">{{if .Message}}{{.Message}}{{else}}-{{end}}</td>
                        <td class="px-5 py-2.5 text-xs text-gray-600">{{timeAgo .CreatedAt}}</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
        {{else}}
        <div class="px-5 py-10 text-center text-gray-600 text-sm">No check results yet</div>
        {{end}}
    </div>

    {{if and $.Data.Changes $.Data.Changes.Data}}
    <div class="bg-surface-100 border border-border rounded-xl overflow-hidden">
        <div class="px-5 py-3.5 border-b border-border">
            <h2 class="text-sm font-medium text-gray-300">Content Changes</h2>
        </div>
        <div class="divide-y divide-border">
            {{range $.Data.Changes.Data}}
            <div class="px-5 py-4">
                <div class="text-xs text-gray-500 mb-2">{{timeAgo .CreatedAt}}</div>
                {{if .Diff}}
                <pre class="text-xs text-gray-300 bg-surface rounded-lg p-3 overflow-x-auto font-mono scrollbar-thin">{{.Diff}}</pre>
                {{end}}
            </div>
            {{end}}
        </div>
    </div>
    {{end}}
</div>
{{end}}
