{{define "title"}}{{if .Data.StatusPage}}Edit Status Page{{else}}New Status Page{{end}}{{end}}
{{define "content"}}
{{$sp := .Data.StatusPage}}
{{$monitors := .Data.Monitors}}
{{$assigned := .Data.Assigned}}
{{$assignedData := .Data.AssignedData}}
<div>
    <div class="flex items-center justify-between mb-5">
        <h1 class="text-[15px] font-medium text-white">{{if $sp}}Edit Status Page{{else}}New Status Page{{end}}</h1>
        <a href="{{.BasePath}}/status-pages" class="text-muted text-[12px] hover:text-muted-light transition-colors">&larr; Back to Status Pages</a>
    </div>

    <form method="POST" action="{{if $sp}}{{.BasePath}}/status-pages/{{$sp.ID}}{{else}}{{.BasePath}}/status-pages{{end}}" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
            <div>
                <label class="form-label">Title</label>
                <input type="text" name="title" value="{{if $sp}}{{$sp.Title}}{{end}}" required
                       class="form-input"
                       placeholder="Service Status">
            </div>

            <div>
                <label class="form-label">URL Slug</label>
                <div class="flex items-center gap-0">
                    <span class="px-3 py-2 bg-surface-200 border border-r-0 border-line rounded-l text-muted text-[13px]">{{.BasePath}}/</span>
                    <input type="text" name="slug" value="{{if $sp}}{{$sp.Slug}}{{else}}status{{end}}" required
                           class="form-input flex-1 rounded-r"
                           placeholder="status" pattern="[a-z0-9][a-z0-9-]*[a-z0-9]|[a-z0-9]">
                </div>
                <p class="mt-1 text-[10px] text-muted">Lowercase letters, numbers, and hyphens only.</p>
            </div>
        </div>

        <div>
            <label class="form-label">Description</label>
            <textarea name="description" rows="2"
                      class="form-input resize-none"
                      placeholder="Current status of our services">{{if $sp}}{{$sp.Description}}{{end}}</textarea>
        </div>

        <div class="flex flex-wrap gap-x-6 gap-y-3">
            <div class="flex items-center gap-3">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="enabled" class="sr-only peer" {{if $sp}}{{if $sp.Enabled}}checked{{end}}{{end}}>
                    <div class="w-9 h-5 bg-surface-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-[#ffffff] after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-brand"></div>
                </label>
                <span class="text-[13px] text-white">Enabled</span>
            </div>

            <div class="flex items-center gap-3">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="api_enabled" class="sr-only peer" {{if $sp}}{{if $sp.APIEnabled}}checked{{end}}{{end}}>
                    <div class="w-9 h-5 bg-surface-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-[#ffffff] after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-brand"></div>
                </label>
                <span class="text-[13px] text-white">Public API</span>
            </div>

            <div class="flex items-center gap-3">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" name="show_incidents" class="sr-only peer" {{if $sp}}{{if $sp.ShowIncidents}}checked{{end}}{{else}}checked{{end}}>
                    <div class="w-9 h-5 bg-surface-300 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-[#ffffff] after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-brand"></div>
                </label>
                <span class="text-[13px] text-white">Show Incidents</span>
            </div>
        </div>

        <div>
            <label class="form-label">Sort Order</label>
            <input type="number" name="sort_order" value="{{if $sp}}{{$sp.SortOrder}}{{else}}0{{end}}"
                   class="form-input w-24">
        </div>

        <div x-data="{search: ''}" class="border border-line rounded-lg p-4">
            <div class="flex items-center justify-between mb-3">
                <label class="text-[11px] text-muted uppercase tracking-widest">Monitors</label>
                <input type="text" x-model="search" placeholder="Filter monitors..."
                       class="px-2.5 py-1.5 bg-surface border border-line rounded text-white text-[12px] focus:outline-none focus:border-brand/30 transition-colors w-48">
            </div>
            <div class="space-y-1 max-h-80 overflow-y-auto">
                {{range $monitors}}
                <div class="flex items-center gap-3 px-3 py-2 rounded hover:bg-surface-50/50 transition-colors"
                     x-show="!search || '{{.Name}}'.toLowerCase().includes(search.toLowerCase())">
                    <input type="checkbox" name="monitor_{{.ID}}_enabled" class="rounded border-line bg-surface text-brand focus:ring-brand/30"
                           {{if index $assigned .ID}}checked{{end}}>
                    <div class="flex-1 min-w-0">
                        <span class="text-[13px] text-white truncate block">{{.Name}}</span>
                        <span class="text-[10px] text-muted">{{typeLabel .Type}}</span>
                    </div>
                    <input type="number" name="monitor_{{.ID}}_sort" placeholder="0"
                           value="{{with index $assignedData .ID}}{{.SortOrder}}{{end}}"
                           class="w-16 px-2 py-1 bg-surface border border-line rounded text-white text-[11px] focus:outline-none focus:border-brand/30 text-center"
                           title="Sort order">
                    <input type="text" name="monitor_{{.ID}}_group" placeholder="Group"
                           value="{{with index $assignedData .ID}}{{.GroupName}}{{end}}"
                           class="w-28 px-2 py-1 bg-surface border border-line rounded text-white text-[11px] focus:outline-none focus:border-brand/30"
                           title="Group name">
                </div>
                {{end}}
            </div>
            {{if not $monitors}}
            <p class="text-muted text-[12px] text-center py-4">No monitors available</p>
            {{end}}
        </div>

        <div x-data="{showAdvanced: false}">
            <button type="button" @click="showAdvanced = !showAdvanced" class="text-[12px] text-muted hover:text-muted-light transition-colors flex items-center gap-1">
                <svg class="w-3 h-3 transition-transform" :class="showAdvanced && 'rotate-90'" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg>
                Advanced
            </button>
            <div x-show="showAdvanced" x-cloak class="mt-3">
                <label class="form-label">Custom CSS</label>
                <textarea name="custom_css" rows="4"
                          class="form-input text-[12px] font-mono resize-y"
                          placeholder="/* Custom styles for this status page */">{{if $sp}}{{$sp.CustomCSS}}{{end}}</textarea>
            </div>
        </div>

        <div class="flex items-center gap-3 pt-2">
            <button type="submit" class="btn-primary">
                {{if $sp}}Update Status Page{{else}}Create Status Page{{end}}
            </button>
            <a href="{{.BasePath}}/status-pages" class="px-4 py-2 border border-line hover:border-line-light text-muted-light text-[13px] rounded transition-colors">Cancel</a>
        </div>
    </form>
</div>
{{end}}
