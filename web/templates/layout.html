{{define "layout"}}
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{template "title" .}} â€” Asura</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: '#0080ff',
                        surface: { DEFAULT: '#09090b', 50: '#0e0e12', 100: '#131318', 200: '#1a1a22', 300: '#222230' },
                        muted: { DEFAULT: '#434656', light: '#a7aabc' },
                        line: { DEFAULT: '#1a1a22', light: '#222230' }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                        mono: ['JetBrains Mono', 'Menlo', 'Consolas', 'monospace'],
                    }
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">
    <script src="{{.BasePath}}/static/htmx.min.js"></script>
    <script defer src="{{.BasePath}}/static/alpine.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .htmx-indicator { opacity: 0; transition: opacity 200ms ease-in; }
        .htmx-request .htmx-indicator, .htmx-request.htmx-indicator { opacity: 1; }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; } 50% { opacity: .35; } }
        .animate-pulse-dot { animation: pulse-dot 2s ease-in-out infinite; }
        ::-webkit-scrollbar { width: 3px; height: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #222230; border-radius: 3px; }
        ::selection { background: rgba(0,128,255,.15); }
    </style>
</head>
<body class="bg-surface text-muted-light font-sans min-h-screen antialiased">
    <div class="flex min-h-screen" x-data="{sidebarOpen: false}">
        {{template "sidebar" .}}

        <div class="fixed inset-0 bg-black/50 z-30 md:hidden" x-show="sidebarOpen" x-transition.opacity @click="sidebarOpen = false" x-cloak></div>

        <main class="flex-1 md:ml-48 min-w-0">
            <div class="sticky top-0 z-20 bg-surface/90 backdrop-blur border-b border-line md:hidden px-4 py-3 flex items-center gap-3">
                <button @click="sidebarOpen = !sidebarOpen" class="text-muted hover:text-white transition-colors">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>
                <img src="{{.BasePath}}/static/logo.gif" alt="Asura" class="h-3">
            </div>
            <div class="px-5 py-6 md:px-8 md:py-8 max-w-6xl">
                {{if .Flash}}
                <div x-data="{show:true}" x-show="show" x-init="setTimeout(()=>show=false,4000)"
                     x-transition:leave="transition duration-200" x-transition:leave-end="opacity-0"
                     class="mb-6 px-4 py-2.5 border border-emerald-500/15 rounded text-emerald-400 text-[13px] flex items-center justify-between">
                    <span>{{.Flash}}</span>
                    <button @click="show=false" class="text-emerald-500/30 hover:text-emerald-400 ml-4">&times;</button>
                </div>
                {{end}}
                {{if .Error}}
                <div class="mb-6 px-4 py-2.5 border border-red-500/15 rounded text-red-400 text-[13px]">{{.Error}}</div>
                {{end}}
                {{template "content" .}}
            </div>
        </main>
    </div>
</body>
</html>
{{end}}

{{define "sidebar"}}
<aside class="fixed left-0 top-0 h-full w-48 bg-surface-50 border-r border-line flex flex-col z-40 transition-transform duration-200 md:translate-x-0"
       :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'">
    <div class="px-5 py-5">
        <a href="{{.BasePath}}/">
            <img src="{{.BasePath}}/static/logo.gif" alt="Asura" class="h-4">
        </a>
    </div>

    <nav class="flex-1 px-2.5 space-y-px">
        <a href="{{.BasePath}}/" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "dashboard"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
            Dashboard
        </a>
        <a href="{{.BasePath}}/monitors" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "monitors"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            Monitors
        </a>
        <a href="{{.BasePath}}/incidents" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "incidents"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            Incidents
        </a>
        <a href="{{.BasePath}}/notifications" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "notifications"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
            Notifications
        </a>
        <a href="{{.BasePath}}/maintenance" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "maintenance"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76Z"/></svg>
            Maintenance
        </a>
    </nav>

    <div class="px-2.5 py-3 border-t border-line">
        <form action="{{.BasePath}}/logout" method="POST">
            <button type="submit" class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] text-muted hover:text-muted-light transition-colors w-full">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                Logout
            </button>
        </form>
        <div class="mt-0.5 px-3 text-[10px] text-muted/50">{{.Version}}</div>
    </div>
</aside>
{{end}}
