{{define "layout"}}
<!DOCTYPE html>
<html lang="en">
<head>
    <script>(function(){var t=localStorage.getItem('theme');if(t==='dark'||(t===null&&window.matchMedia('(prefers-color-scheme: dark)').matches)){document.documentElement.classList.add('dark');}})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{template "title" .}} â€” Asura</title>
    <link rel="icon" href="{{.BasePath}}/static/favicon.ico">
    <link rel="stylesheet" href="{{.BasePath}}/static/tailwind.css">
    <link rel="stylesheet" href="{{.BasePath}}/static/uplot.min.css">
    <script src="{{.BasePath}}/static/uplot.iife.min.js"></script>
    <script src="{{.BasePath}}/static/htmx.min.js"></script>
    <script defer src="{{.BasePath}}/static/alpine.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .htmx-indicator { opacity: 0; transition: opacity 200ms ease-in; }
        .htmx-request .htmx-indicator, .htmx-request.htmx-indicator { opacity: 1; }
        @keyframes pulse-dot { 0%, 100% { opacity: 1; } 50% { opacity: .35; } }
        .animate-pulse-dot { animation: pulse-dot 2s ease-in-out infinite; }
        ::-webkit-scrollbar { width: 3px; height: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgb(var(--line-light-rgb)); border-radius: 3px; }
        ::selection { background: rgba(0,128,255,.15); }
        .u-wrap { background: transparent !important; }
        .u-cursor-x, .u-cursor-y { border-color: rgb(var(--muted-rgb)) !important; }
        .u-hz .u-cursor-x, .u-vt .u-cursor-y { border-right-style: dashed !important; border-bottom-style: dashed !important; }
        select.form-select {
            appearance: none;
            -webkit-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1rem;
            padding-right: 2rem;
        }
    </style>
</head>
<body class="bg-surface text-muted-light font-sans min-h-screen antialiased">
    <div class="flex min-h-screen" x-data="{sidebarOpen: false}">
        {{template "sidebar" .}}

        <div class="fixed inset-0 bg-black/50 z-30 md:hidden" x-show="sidebarOpen" x-transition.opacity @click="sidebarOpen = false" x-cloak></div>

        <main class="flex-1 md:ml-48 min-w-0">
            <div class="sticky top-0 z-20 bg-surface/90 backdrop-blur border-b border-line md:hidden px-4 py-3 flex items-center gap-3">
                <button @click="sidebarOpen = !sidebarOpen" class="text-muted hover:text-white transition-colors">
                    <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
                </button>
                <img src="{{.BasePath}}/static/logo.gif" alt="Asura" class="h-3">
            </div>
            <div class="px-5 py-6 md:px-8 md:py-8 max-w-6xl">
                {{if .Flash}}
                <div x-data="{show:true}" x-show="show" x-init="setTimeout(()=>show=false,4000)"
                     x-transition:leave="transition duration-200" x-transition:leave-end="opacity-0"
                     class="mb-6 px-4 py-2.5 border border-emerald-500/15 rounded text-emerald-400 text-[13px] flex items-center justify-between">
                    <span>{{.Flash}}</span>
                    <button @click="show=false" class="text-emerald-500/30 hover:text-emerald-400 ml-4">&times;</button>
                </div>
                {{end}}
                {{if .Error}}
                <div class="mb-6 px-4 py-2.5 border border-red-500/15 rounded text-red-400 text-[13px]">{{.Error}}</div>
                {{end}}
                {{template "content" .}}
            </div>
        </main>
    </div>
<script>function toggleTheme(){var d=document.documentElement.classList.toggle('dark');localStorage.setItem('theme',d?'dark':'light');window.dispatchEvent(new CustomEvent('theme-changed'));}</script>
</body>
</html>
{{end}}

{{define "sidebar"}}
<aside class="fixed left-0 top-0 h-full w-48 bg-surface-50 border-r border-line flex flex-col z-40 transition-transform duration-200 md:translate-x-0"
       :class="sidebarOpen ? 'translate-x-0' : '-translate-x-full'">
    <div class="px-5 py-5">
        <a href="{{.BasePath}}/">
            <img src="{{.BasePath}}/static/logo.gif" alt="Asura" class="h-4">
        </a>
    </div>

    <nav class="flex-1 px-2.5 space-y-px">
        <a href="{{.BasePath}}/" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "dashboard"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
            Dashboard
        </a>
        <a href="{{.BasePath}}/monitors" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "monitors"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            Monitors
        </a>
        <a href="{{.BasePath}}/incidents" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "incidents"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
            Incidents
        </a>
        <a href="{{.BasePath}}/notifications" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "notifications"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
            Notifications
        </a>
        <a href="{{.BasePath}}/maintenance" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "maintenance"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76Z"/></svg>
            Maintenance
        </a>
        <a href="{{.BasePath}}/logs" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "logs"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8Z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            Logs
        </a>
        <a href="{{.BasePath}}/status-settings" @click="sidebarOpen=false"
           class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] transition-colors {{if eq .Active "status-settings"}}text-brand bg-brand/[0.06]{{else}}text-muted-light hover:text-white hover:bg-surface-200/40{{end}}">
            <svg class="w-4 h-4 flex-shrink-0" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
            Status Page
        </a>
    </nav>

    <div class="px-2.5 py-3 border-t border-line">
        <form action="{{.BasePath}}/logout" method="POST">
            <button type="submit" class="flex items-center gap-2.5 px-3 py-[7px] rounded text-[13px] text-muted hover:text-muted-light transition-colors w-full">
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                Logout
            </button>
        </form>
        <div class="mt-1 px-3 flex items-center justify-between">
            <span class="text-[10px] text-muted/50">{{.Version}}</span>
            <div class="flex items-center gap-3">
                <a href="https://github.com/y0f/Asura" target="_blank" rel="noopener" class="text-muted/50 hover:text-white transition-colors">
                    <svg class="w-4 h-4" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                </a>
                <button onclick="toggleTheme()" class="text-muted/50 hover:text-white transition-colors" title="Toggle theme">
                    <svg class="w-4 h-4 dark:hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                    <svg class="w-4 h-4 hidden dark:block" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                </button>
            </div>
        </div>
    </div>
</aside>
{{end}}
