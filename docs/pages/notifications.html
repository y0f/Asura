<h1>Notifications</h1>

<p>6 notification channels. Each one can be scoped to specific event types and routed to specific monitors.</p>

<p>Events: <code>incident.created</code>, <code>incident.acknowledged</code>, <code>incident.resolved</code>, <code>incident.reminder</code>, <code>content.changed</code></p>

<p>The <code>incident.reminder</code> event fires when a monitor's <code>resend_interval</code> elapses while an incident is still open, re-alerting channels that subscribe to it.</p>

<h2>Webhook</h2>

<pre><code>{
  "type": "webhook",
  "settings": {
    "url": "https://example.com/hook",
    "secret": "hmac-secret"
  }
}</code></pre>

<p>When a <code>secret</code> is set, Asura signs every payload with HMAC-SHA256 and sends the signature in the <code>X-Asura-Signature</code> header as <code>sha256=&lt;hex&gt;</code>.</p>

<h3>Webhook Signing</h3>

<p>To verify a webhook delivery:</p>
<ol>
  <li>Read the raw request body</li>
  <li>Compute <code>HMAC-SHA256(secret, body)</code></li>
  <li>Compare with the hex value after <code>sha256=</code> in the <code>X-Asura-Signature</code> header</li>
</ol>

<h2>Email (SMTP)</h2>

<pre><code>{
  "type": "email",
  "settings": {
    "host": "smtp.example.com",
    "port": 587,
    "username": "alerts@example.com",
    "password": "...",
    "from": "alerts@example.com",
    "to": ["ops@example.com", "oncall@example.com"]
  }
}</code></pre>

<h2>Telegram</h2>

<pre><code>{
  "type": "telegram",
  "settings": {
    "bot_token": "123456:ABC-DEF...",
    "chat_id": "-1001234567890"
  }
}</code></pre>

<h2>Discord</h2>

<pre><code>{
  "type": "discord",
  "settings": {
    "webhook_url": "https://discord.com/api/webhooks/..."
  }
}</code></pre>

<h2>Slack</h2>

<pre><code>{
  "type": "slack",
  "settings": {
    "webhook_url": "https://hooks.slack.com/services/...",
    "channel": "#alerts"
  }
}</code></pre>

<h2>ntfy</h2>

<pre><code>{
  "type": "ntfy",
  "settings": {
    "topic": "my-alerts",
    "server_url": "https://ntfy.sh",
    "priority": 4,
    "tags": "warning"
  }
}</code></pre>

<p><code>server_url</code> defaults to <code>https://ntfy.sh</code> if omitted. <code>priority</code> (1-5), <code>tags</code>, and <code>click_url</code> are optional.</p>

<h2>Per-Monitor Routing</h2>

<p>By default every channel gets every event. To limit which channels a monitor sends to, set <code>notification_channel_ids</code>:</p>

<pre><code>curl -X PUT https://example.com/asura/api/v1/monitors/1 \
  -H "X-API-Key: $KEY" \
  -H "Content-Type: application/json" \
  -d '{"notification_channel_ids": [1, 3]}'</code></pre>

<p>An empty array (<code>[]</code>) means the monitor sends to all channels.</p>
