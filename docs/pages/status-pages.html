<h1>Status Pages</h1>

<p>Public-facing pages that display the real-time and historical health of your monitors. Each status page has its own URL slug, optional password protection, and 90-day uptime bars per monitor.</p>

<h2>Creating a Status Page</h2>

<p>Go to <strong>Status Pages → New Status Page</strong> in the sidebar. The minimum required fields are a title and slug.</p>

<table>
  <tr><th>Field</th><th>Description</th></tr>
  <tr><td><code>title</code></td><td>Display name shown in the page header</td></tr>
  <tr><td><code>slug</code></td><td>URL path segment. Lowercase letters, numbers, and hyphens. The page is served at <code>/{slug}</code></td></tr>
  <tr><td><code>description</code></td><td>Short subtitle shown below the title</td></tr>
  <tr><td><code>enabled</code></td><td>When off, the public page returns 404. The admin API still works.</td></tr>
  <tr><td><code>api_enabled</code></td><td>Expose a public JSON endpoint at <code>/api/v1/status-pages/{id}/public</code> without authentication. Independent from the HTML page.</td></tr>
  <tr><td><code>show_incidents</code></td><td>Display recent incidents below the monitor list</td></tr>
  <tr><td><code>sort_order</code></td><td>Controls ordering in the admin list</td></tr>
</table>

<h2>Monitor Assignment</h2>

<p>Select which monitors appear on the page. When a monitor is checked, two additional fields appear:</p>

<table>
  <tr><th>Field</th><th>Description</th></tr>
  <tr><td><strong>Sort order</strong></td><td>Integer controlling position within the page (lower = higher)</td></tr>
  <tr><td><strong>Group name</strong></td><td>Optional label. Monitors with the same group name are grouped under a shared heading on the public page</td></tr>
</table>

<h2>Branding</h2>

<p>Expand the <strong>Advanced</strong> section to customise the appearance of the public page.</p>

<table>
  <tr><th>Field</th><th>Description</th></tr>
  <tr><td><code>logo_url</code></td><td>URL of an image displayed above the status banner. Useful for showing your product or company logo.</td></tr>
  <tr><td><code>favicon_url</code></td><td>URL of a favicon for the status page tab. Defaults to the Asura favicon.</td></tr>
  <tr><td><code>custom_header_html</code></td><td>Raw HTML injected before the status banner. Useful for custom headings, banners, or links. Rendered with <code>templ.Raw()</code> — trust only your own content here.</td></tr>
  <tr><td><code>custom_css</code></td><td>CSS injected into the <code>&lt;style&gt;</code> block. Overrides any default styles.</td></tr>
  <tr><td><code>analytics_script</code></td><td>HTML snippet (e.g. a Plausible or Fathom <code>&lt;script&gt;</code> tag) injected before <code>&lt;/body&gt;</code>.</td></tr>
</table>

<h2>Password Protection</h2>

<p>Set a password in the <strong>Password Protection</strong> field under Advanced. Visitors are redirected to a login form at <code>/{slug}/auth</code> and receive a 7-day <code>HttpOnly</code> cookie on success.</p>

<ul>
  <li>The password is stored as a SHA-256 hash — never in plain text</li>
  <li>Password comparison uses constant-time comparison to prevent timing attacks</li>
  <li>Auth attempts are rate-limited using the same limiter as admin login</li>
  <li>Leave the field blank when editing to keep the existing password unchanged</li>
  <li>Tick <strong>Remove password protection</strong> to clear the password and make the page publicly accessible</li>
</ul>

<h2>Public JSON API</h2>

<p>When <code>api_enabled</code> is on, Asura serves a machine-readable endpoint:</p>

<pre><code>GET /api/v1/status-pages/{id}/public</code></pre>

<p>No authentication required. Response is cached for 30 seconds via <code>Cache-Control: public, max-age=30</code>.</p>

<pre><code>{
  "page": {
    "title": "Service Status",
    "description": "Current status of our services"
  },
  "overall_status": "operational",
  "monitors": [
    {
      "id": 1,
      "name": "API",
      "type": "http",
      "status": "up",
      "uptime_90d": 99.94,
      "daily_uptime": [
        { "date": "2025-01-01", "uptime_pct": 100, "up_count": 1440, "down_count": 0 },
        ...
      ]
    }
  ],
  "incidents": [
    {
      "id": 3,
      "monitor_name": "API",
      "status": "resolved",
      "cause": "Connection refused",
      "started_at": "2025-01-15T14:22:00Z",
      "resolved_at": "2025-01-15T14:35:00Z"
    }
  ]
}</code></pre>

<p><code>overall_status</code> is one of <code>operational</code>, <code>degraded</code>, or <code>down</code>, derived from the worst current monitor status on the page.</p>

<h2>Admin REST API</h2>

<p>All endpoints require authentication.</p>

<table>
  <tr><th>Method</th><th>Path</th><th>Description</th></tr>
  <tr><td><code>GET</code></td><td><code>/api/v1/status-pages</code></td><td>List all status pages</td></tr>
  <tr><td><code>POST</code></td><td><code>/api/v1/status-pages</code></td><td>Create a status page</td></tr>
  <tr><td><code>GET</code></td><td><code>/api/v1/status-pages/{id}</code></td><td>Get a status page with its monitor list</td></tr>
  <tr><td><code>PUT</code></td><td><code>/api/v1/status-pages/{id}</code></td><td>Update a status page</td></tr>
  <tr><td><code>DELETE</code></td><td><code>/api/v1/status-pages/{id}</code></td><td>Delete a status page</td></tr>
</table>

<h3>Create / Update body</h3>

<pre><code>{
  "title": "Service Status",
  "slug": "status",
  "description": "Current status of our services",
  "enabled": true,
  "api_enabled": false,
  "show_incidents": true,
  "sort_order": 0,
  "logo_url": "https://example.com/logo.png",
  "favicon_url": "https://example.com/favicon.ico",
  "custom_header_html": "",
  "custom_css": "",
  "analytics_script": "",
  "password": "optional-plain-text-password",
  "monitors": [
    { "monitor_id": 1, "sort_order": 0, "group_name": "Core" },
    { "monitor_id": 2, "sort_order": 1, "group_name": "Core" },
    { "monitor_id": 3, "sort_order": 0, "group_name": "Third-party" }
  ]
}</code></pre>

<p>On <code>PUT</code>, omit <code>password</code> (or send an empty string) to leave the existing password unchanged. Send <code>"clear_password": true</code> to remove password protection.</p>
